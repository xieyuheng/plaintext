<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>cli/cli-toc.ts</title>
</head>
<body>
<pre style="white-space: pre-wrap;">import * as pln from &quot;../api&quot;
import readdir_rec from &quot;fs-readdir-recursive&quot;
import process from &quot;process&quot;
import path from &quot;path&quot;
import fs from &quot;fs&quot;

export function run(dir: string, opts: any): void {
  if (!fs.existsSync(dir)) {
    console.log(`dir does not exist: ${dir}`)
    process.exit(1)
  }

  if (!fs.lstatSync(dir).isDirectory()) {
    console.log(`path does not refer to a directory: ${dir}`)
    process.exit(1)
  }

  const output_file = path.resolve(opts.output)
  if (opts.verbose !== undefined) {
    console.log(`output file: ${output_file}`)
  }

  let files = readdir_rec(dir)
  files = pln.sort_files(files)
  if (opts.verbose !== undefined) {
    console.log(`number of files: ${files.length}`)
  }

  const text = files.map((file) =&gt; `link:${file}\n`).join(&quot;&quot;)

  fs.mkdirSync(path.dirname(output_file), { recursive: true })
  fs.writeFile(output_file, text, (error) =&gt; {
    if (error) {
      console.log(error)
    }
  })
}
</pre>
</body>
</html>
